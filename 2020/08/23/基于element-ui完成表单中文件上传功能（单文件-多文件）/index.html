<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/blog/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/blog/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/blog/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/blog/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="前端,JS,Vue,element ui,表单,upload,">










<meta name="description" content="前不久使用的时候发现element ui的el-upload还是有不少坑，单文件多文件上传因为后端约定的接口方式也有些不一样，后面又做了一下切片上传和文件下载，因此做一个总结">
<meta name="keywords" content="前端,JS,Vue,element ui,表单,upload">
<meta property="og:type" content="article">
<meta property="og:title" content="基于element-ui完成表单中文件上传功能（单文件-多文件-下载）">
<meta property="og:url" content="https://www.kffhi.com/blog/2020/08/23/基于element-ui完成表单中文件上传功能（单文件-多文件）/index.html">
<meta property="og:site_name" content="Kffhi的博客">
<meta property="og:description" content="前不久使用的时候发现element ui的el-upload还是有不少坑，单文件多文件上传因为后端约定的接口方式也有些不一样，后面又做了一下切片上传和文件下载，因此做一个总结">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://www.kffhi.com/public/blog/images/20200919/1.png">
<meta property="og:image" content="https://www.kffhi.com/public/blog/images/20200919/2.png">
<meta property="og:image" content="https://www.kffhi.com/public/blog/images/20200919/3.png">
<meta property="og:updated_time" content="2020-09-19T05:57:35.006Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="基于element-ui完成表单中文件上传功能（单文件-多文件-下载）">
<meta name="twitter:description" content="前不久使用的时候发现element ui的el-upload还是有不少坑，单文件多文件上传因为后端约定的接口方式也有些不一样，后面又做了一下切片上传和文件下载，因此做一个总结">
<meta name="twitter:image" content="https://www.kffhi.com/public/blog/images/20200919/1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/blog/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://www.kffhi.com/blog/2020/08/23/基于element-ui完成表单中文件上传功能（单文件-多文件）/">





  <title>基于element-ui完成表单中文件上传功能（单文件-多文件-下载） | Kffhi的博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/blog/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Kffhi的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/blog/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/blog/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/blog/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/blog/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.kffhi.com/blog/blog/2020/08/23/基于element-ui完成表单中文件上传功能（单文件-多文件）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kffhi">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kffhi的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">基于element-ui完成表单中文件上传功能（单文件-多文件-下载）</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-23T14:30:48+08:00">
                2020-08-23
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/前端/JS/" itemprop="url" rel="index">
                    <span itemprop="name">JS</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/前端/JS/Vue/" itemprop="url" rel="index">
                    <span itemprop="name">Vue</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>前不久使用的时候发现element ui的el-upload还是有不少坑，单文件多文件上传因为后端约定的接口方式也有些不一样，后面又做了一下切片上传和文件下载，因此做一个总结</p>
<a id="more"></a>
<h4 id="普通上传"><a href="#普通上传" class="headerlink" title="普通上传"></a>普通上传</h4><h5 id="在from中使用"><a href="#在from中使用" class="headerlink" title="在from中使用"></a>在from中使用</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-form-item label=&quot;选择文件&quot; prop=&quot;modelFile&quot;&gt;</span><br><span class="line">    &lt;el-upload</span><br><span class="line">        :with-credentials=&quot;true&quot;</span><br><span class="line">        ref=&quot;uploadModel&quot;</span><br><span class="line">        :file-list=&quot;modelForm.modelFile&quot;</span><br><span class="line">        accept=&quot;.glb&quot;</span><br><span class="line">        :on-change=&quot;getFileName&quot;</span><br><span class="line">        multiple</span><br><span class="line">        :action=&quot;uploadAction&quot;</span><br><span class="line">        :auto-upload=&quot;false&quot;</span><br><span class="line">        :show-file-list=&quot;false&quot;</span><br><span class="line">        :http-request=&quot;uploadFile&quot;</span><br><span class="line">    &gt;</span><br><span class="line">        &lt;el-input placeholder=&quot;请选择文件&quot; v-model=&quot;modelFileNames&quot; suffix-icon=&quot;el-icon-upload2&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">    &lt;/el-upload&gt;</span><br><span class="line">&lt;/el-form-item&gt;</span><br></pre></td></tr></table></figure>
<p>这里需求实现的效果如图，隐藏文件列表但是展示文件名，当点击下方时提交表单并上传文件</p>
<p><img src="https://www.kffhi.com/public/blog/images/20200919/1.png" alt></p>
<p>主要注意几个参数：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>类型</th>
<th>可选值</th>
<th>默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td>with-credentials</td>
<td>支持发送 cookie 凭证信息</td>
<td>boolean</td>
<td>/</td>
<td>false</td>
</tr>
<tr>
<td>file-list</td>
<td>上传的文件列表, 例如: [{name: ‘food.jpg’, url: ‘<a href="https://xxx.cdn.com/xxx.jpg&#39;}]" target="_blank" rel="noopener">https://xxx.cdn.com/xxx.jpg&#39;}]</a></td>
<td>array</td>
<td>/</td>
<td>[]</td>
</tr>
<tr>
<td>action</td>
<td>必选参数，上传的地址</td>
<td>string</td>
<td>/</td>
<td>/</td>
</tr>
<tr>
<td>auto-upload</td>
<td>是否在选取文件后立即进行上传</td>
<td>boolean</td>
<td>/</td>
<td>true</td>
</tr>
<tr>
<td>http-request</td>
<td>覆盖默认的上传行为，可以自定义上传的实现</td>
<td>function</td>
<td>/</td>
<td>/</td>
</tr>
</tbody>
</table>
<h5 id="自定义的上传"><a href="#自定义的上传" class="headerlink" title="自定义的上传"></a><strong>自定义的上传</strong></h5><p>这里采用完全自定义上传的方式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">uploadModel() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.onlyOneFile) &#123;</span><br><span class="line">        <span class="keyword">this</span>.fileData = <span class="keyword">new</span> FormData() <span class="comment">// new formData对象</span></span><br><span class="line">        <span class="keyword">this</span>.$refs.uploadModel.submit() <span class="comment">// 提交调用uploadFile函数</span></span><br><span class="line">        <span class="keyword">let</span> params = &#123;</span><br><span class="line">            categoryId: <span class="keyword">this</span>.modelForm.categoryId,</span><br><span class="line">            files: <span class="keyword">this</span>.fileData</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.$store.dispatch(<span class="string">'model/uploadModel'</span>, params).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            config.CallbackHandler(res).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (res.code === <span class="string">'200'</span>) &#123;</span><br><span class="line">                    <span class="comment">// console</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 上传文件formData处理</span></span><br><span class="line">uploadFile(file) &#123;</span><br><span class="line">	<span class="keyword">this</span>.fileData.append(<span class="string">'files'</span>, file.file)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>请求参数</p>
<p><img src="https://www.kffhi.com/public/blog/images/20200919/2.png" alt></p>
<h5 id="默认上传"><a href="#默认上传" class="headerlink" title="默认上传"></a><strong>默认上传</strong></h5><p>若不采用自定义上传，则直接调用<code>this.$refs.upload.submit()</code>,同时注意这几个参数：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>类型</th>
<th>可选值</th>
<th>默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td>data</td>
<td>上传时附带的额外参数</td>
<td>object</td>
<td>/</td>
<td>/</td>
</tr>
<tr>
<td>name</td>
<td>上传的字段名</td>
<td>string</td>
<td>/</td>
<td>file</td>
</tr>
<tr>
<td>header</td>
<td>设置上传的请求头部</td>
<td>object</td>
<td>/</td>
<td>/</td>
</tr>
</tbody>
</table>
<p>而且经测试多文件上传时element是多次请求而不是统一请求，因此建议多文件上传还是采用自定义的方式</p>
<h4 id="分片上传"><a href="#分片上传" class="headerlink" title="分片上传"></a>分片上传</h4><p>切片上传建议先阅读这个<a href="https://www.helloweba.net/javascript/632.html" target="_blank" rel="noopener">系列博客</a></p>
<p>简而言之，实现切片上传主要分为以下几步：</p>
<ul>
<li>通过MD5校验文件是否存在<ul>
<li>存在，秒传</li>
<li>不存在，进入下面步骤</li>
</ul>
</li>
<li>前端切片</li>
<li>服务端检验每个切片是否存在</li>
<li>分片上传</li>
<li>合并文件</li>
</ul>
<h5 id="上传组件的实现"><a href="#上传组件的实现" class="headerlink" title="上传组件的实现"></a>上传组件的实现</h5><p>基于上文博客，基于业务设计需求做了一定的暴力修改</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div id=&quot;global-uploader&quot;&gt;</span><br><span class="line">		&lt;!-- 上传 --&gt;</span><br><span class="line">		&lt;uploader</span><br><span class="line">			ref=&quot;uploader&quot;</span><br><span class="line">			:options=&quot;options&quot;</span><br><span class="line">			:autoStart=&quot;false&quot;</span><br><span class="line">			@file-added=&quot;onFileAdded&quot;</span><br><span class="line">			@file-success=&quot;onFileSuccess&quot;</span><br><span class="line">			@file-progress=&quot;onFileProgress&quot;</span><br><span class="line">			@file-error=&quot;onFileError&quot;</span><br><span class="line">			class=&quot;uploader-app&quot;</span><br><span class="line">		&gt;</span><br><span class="line">			&lt;uploader-unsupport&gt;&lt;/uploader-unsupport&gt;</span><br><span class="line"></span><br><span class="line">			&lt;uploader-btn id=&quot;global-uploader-btn&quot; :attrs=&quot;attrs&quot; ref=&quot;uploadBtn&quot;&gt;选择文件&lt;/uploader-btn&gt;</span><br><span class="line"></span><br><span class="line">			&lt;uploader-list v-show=&quot;panelShow&quot;&gt;</span><br><span class="line">				&lt;div class=&quot;file-panel&quot; slot-scope=&quot;props&quot; :class=&quot;&#123; collapse: collapse &#125;&quot;&gt;</span><br><span class="line">					&lt;ul class=&quot;file-list&quot; ref=&quot;uploader-file-list&quot;&gt;</span><br><span class="line">						&lt;li v-for=&quot;file in props.fileList&quot; :key=&quot;file.id&quot;&gt;</span><br><span class="line">							&lt;uploader-file :class=&quot;&apos;file_&apos; + file.id&quot; ref=&quot;files&quot; :file=&quot;file&quot; :list=&quot;true&quot;&gt;&lt;/uploader-file&gt;</span><br><span class="line">						&lt;/li&gt;</span><br><span class="line">						&lt;div class=&quot;no-file&quot; v-if=&quot;!props.fileList.length&quot;&gt;&lt;i class=&quot;iconfont icon-empty-file&quot;&gt;&lt;/i&gt; 暂无待上传文件&lt;/div&gt;</span><br><span class="line">					&lt;/ul&gt;</span><br><span class="line">				&lt;/div&gt;</span><br><span class="line">			&lt;/uploader-list&gt;</span><br><span class="line">		&lt;/uploader&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import SparkMD5 from &apos;spark-md5&apos;</span><br><span class="line">import api from &apos;@/common/api&apos;</span><br><span class="line">var loadingFileMap = &#123;&#125;</span><br><span class="line">const statusMap = &#123;</span><br><span class="line">	md5: &#123;</span><br><span class="line">		text: &apos;校验MD5&apos;,</span><br><span class="line">		bgc: &apos;#fff&apos;</span><br><span class="line">	&#125;,</span><br><span class="line">	merging: &#123;</span><br><span class="line">		text: &apos;合并中&apos;,</span><br><span class="line">		bgc: &apos;#e2eeff&apos;</span><br><span class="line">	&#125;,</span><br><span class="line">	success: &#123;</span><br><span class="line">		text: &apos;上传成功&apos;,</span><br><span class="line">		bgc: &apos;#e2eeff&apos;</span><br><span class="line">	&#125;,</span><br><span class="line">	transcoding: &#123;</span><br><span class="line">		text: &apos;转码中&apos;,</span><br><span class="line">		bgc: &apos;#e2eeff&apos;</span><br><span class="line">	&#125;,</span><br><span class="line">	paused: &#123;</span><br><span class="line">		text: &apos;暂停上传&apos;,</span><br><span class="line">		bgc: &apos;#e2eeff&apos;</span><br><span class="line">	&#125;,</span><br><span class="line">	failed: &#123;</span><br><span class="line">		text: &apos;上传失败&apos;,</span><br><span class="line">		bgc: &apos;#e2eeff&apos;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">export default &#123;</span><br><span class="line">	name: &apos;upload&apos;,</span><br><span class="line">	props: &#123;</span><br><span class="line">		fileExt: Array</span><br><span class="line">	&#125;,</span><br><span class="line">	data() &#123;</span><br><span class="line">		return &#123;</span><br><span class="line">			options: &#123;</span><br><span class="line">				target: api.getUrl(&apos;fileupload&apos;),</span><br><span class="line">				singleFile: true,</span><br><span class="line">				chunkSize: &apos;5120000&apos;,</span><br><span class="line">				fileParameterName: &apos;file&apos;,</span><br><span class="line">				maxChunkRetries: 3,</span><br><span class="line">				withCredentials: true, //带session</span><br><span class="line">				testChunks: true, //是否开启服务器分片校验</span><br><span class="line">				// 服务器分片校验函数，秒传及断点续传基础</span><br><span class="line">				checkChunkUploadedByResponse: function(chunk, message) &#123;</span><br><span class="line">					let res = JSON.parse(message)</span><br><span class="line">					if (!res.status || loadingFileMap[chunk.file.fid]) &#123;</span><br><span class="line">						return true</span><br><span class="line">					&#125;</span><br><span class="line">					return (res.uploaded || []).indexOf(chunk.offset + 1) &gt;= 0</span><br><span class="line">				&#125;,</span><br><span class="line">				query() &#123;&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			attrs: &#123;</span><br><span class="line">				accept: this.fileExt</span><br><span class="line">			&#125;,</span><br><span class="line">			panelShow: false, //选择文件后，展示上传panel</span><br><span class="line">			collapse: false</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	computed: &#123;</span><br><span class="line">		//Uploader实例</span><br><span class="line">		uploader() &#123;</span><br><span class="line">			return this.$refs.uploader.uploader</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	methods: &#123;</span><br><span class="line">		openUploader() &#123;</span><br><span class="line">			if (this.$refs.uploadBtn) &#123;</span><br><span class="line">				this.$refs.uploadBtn.$el.click()</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		onFileAdded(file) &#123;</span><br><span class="line">			this.$emit(&apos;fileAdded&apos;, file)</span><br><span class="line">			this.panelShow = true</span><br><span class="line">			this.computeMD5(file)</span><br><span class="line">		&#125;,</span><br><span class="line">		// eslint-disable-next-line</span><br><span class="line">        onFileProgress(rootFile, file, chunk) &#123;</span><br><span class="line">			//   console.log(`上传中 $&#123;file.name&#125;，chunk：$&#123;chunk.startByte / 1024 / 1024&#125; ~ $&#123;chunk.endByte / 1024 / 1024&#125;`)</span><br><span class="line">		&#125;,</span><br><span class="line">		// eslint-disable-next-line</span><br><span class="line">        onFileSuccess(rootFile, file, response, chunk) &#123;</span><br><span class="line">			// 分片服务端返回需要合并</span><br><span class="line">			// 如果文件存在 秒传</span><br><span class="line">			if (loadingFileMap[chunk.file.fid]) &#123;</span><br><span class="line">				this.statusSet(file.id, &apos;success&apos;)</span><br><span class="line">				return this.$emit(&apos;fileSuccess&apos;, file)</span><br><span class="line">			&#125;</span><br><span class="line">			this.statusSet(file.id, &apos;merging&apos;)</span><br><span class="line">			let param = &#123;</span><br><span class="line">				ext: file.fileType,</span><br><span class="line">				fid: file.fid,</span><br><span class="line">				identifier: file.uniqueIdentifier,</span><br><span class="line">				filename: file.name</span><br><span class="line">			&#125;</span><br><span class="line">			this.$store</span><br><span class="line">				.dispatch(&apos;model/mergeFile&apos;, param)</span><br><span class="line">				.then(res =&gt; &#123;</span><br><span class="line">					if (res.status) &#123;</span><br><span class="line">						this.$emit(&apos;fileSuccess&apos;, file)</span><br><span class="line">						this.statusSet(file.id, &apos;success&apos;)</span><br><span class="line">					&#125; else &#123;</span><br><span class="line">						this.$emit(&apos;fileSuccess&apos;, file)</span><br><span class="line">						this.statusSet(file.id, &apos;failed&apos;)</span><br><span class="line">						this.$message(&#123;</span><br><span class="line">							message: res.message,</span><br><span class="line">							type: &apos;error&apos;</span><br><span class="line">						&#125;)</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;)</span><br><span class="line">				.catch(() =&gt; &#123;</span><br><span class="line">					this.statusSet(file.id, &apos;failed&apos;)</span><br><span class="line">				&#125;)</span><br><span class="line">		&#125;,</span><br><span class="line">		// eslint-disable-next-line</span><br><span class="line">        onFileError(rootFile, file, response, chunk) &#123;</span><br><span class="line">			this.statusSet(file.id, &apos;failed&apos;)</span><br><span class="line">			this.$emit(&apos;fileError&apos;, response)</span><br><span class="line">			// this.$message(&#123;</span><br><span class="line">			// 	message: response,</span><br><span class="line">			// 	type: &apos;error&apos;</span><br><span class="line">			// &#125;)</span><br><span class="line">		&#125;,</span><br><span class="line"></span><br><span class="line">		/**</span><br><span class="line">		 * 计算md5，实现断点续传及秒传</span><br><span class="line">		 * @param file</span><br><span class="line">		 */</span><br><span class="line">		computeMD5(file) &#123;</span><br><span class="line">			let fileReader = new FileReader()</span><br><span class="line">			//   let time = new Date().getTime()</span><br><span class="line">			let md5 = &apos;&apos;</span><br><span class="line"></span><br><span class="line">			file.pause()</span><br><span class="line">			//开始计算md5</span><br><span class="line">			this.statusSet(file.id, &apos;md5&apos;)</span><br><span class="line">			//保护</span><br><span class="line">			this.protectComputeMd5(file.id, true)</span><br><span class="line">			let blobSlice = File.prototype.slice || File.prototype.mozSlice || File.prototype.webkitSlice,</span><br><span class="line">				chunkSize = 102400000, // 以每片100MB大小来逐次读取</span><br><span class="line">				chunks = Math.ceil(file.size / chunkSize),</span><br><span class="line">				currentChunk = 0,</span><br><span class="line">				spark = new SparkMD5() //创建SparkMD5的实例</span><br><span class="line"></span><br><span class="line">			loadNext()</span><br><span class="line">			fileReader.onload = e =&gt; &#123;</span><br><span class="line">				spark.appendBinary(e.target.result)</span><br><span class="line">				currentChunk += 1</span><br><span class="line">				if (currentChunk &lt; chunks) &#123;</span><br><span class="line">					loadNext()</span><br><span class="line">				&#125; else &#123;</span><br><span class="line">					md5 = spark.end()</span><br><span class="line">					let param = &#123;</span><br><span class="line">						filename: file.name,</span><br><span class="line">						identifier: md5,</span><br><span class="line">						totalSize: file.size,</span><br><span class="line">						fileType: file.fileType</span><br><span class="line">					&#125;</span><br><span class="line">					this.$store.dispatch(&apos;model/checkFile&apos;, param).then(res =&gt; &#123;</span><br><span class="line">						this.statusSet(file.id, &apos;paused&apos;)</span><br><span class="line">						//取消保护md5</span><br><span class="line">						this.protectComputeMd5(file.id, false)</span><br><span class="line">						file.uniqueIdentifier = md5</span><br><span class="line">						// 添加额外的参数</span><br><span class="line">						this.uploader.opts.query = &#123;</span><br><span class="line">							fid: res.data</span><br><span class="line">						&#125;</span><br><span class="line">						if (!res.status) &#123;</span><br><span class="line">							//秒传</span><br><span class="line">							loadingFileMap[res.data] = true</span><br><span class="line">						&#125;</span><br><span class="line">						file.fid = res.data</span><br><span class="line">						file.resume()</span><br><span class="line">					&#125;)</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			function loadNext() &#123;</span><br><span class="line">				let start = currentChunk * chunkSize,</span><br><span class="line">					end = start + chunkSize &gt;= file.size ? file.size : start + chunkSize</span><br><span class="line">				//   debugger</span><br><span class="line">				fileReader.readAsBinaryString(blobSlice.call(file.file, start, end))</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			fileReader.onerror = function() &#123;</span><br><span class="line">				this.error(&apos;FileReader onerror was triggered, maybe the browser aborted due to high memory usage.&apos;)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line"></span><br><span class="line">		/**</span><br><span class="line">		 * 新增的自定义的状态: &apos;md5&apos;、&apos;transcoding&apos;、&apos;failed&apos;</span><br><span class="line">		 * @param id</span><br><span class="line">		 * @param status</span><br><span class="line">		 */</span><br><span class="line">		statusSet(id, status) &#123;</span><br><span class="line">			this.$nextTick(() =&gt; &#123;</span><br><span class="line">				let _tag = this.$refs[&apos;uploader-file-list&apos;]</span><br><span class="line">					.getElementsByClassName(&apos;file_&apos; + id)[0]</span><br><span class="line">					.getElementsByClassName(&apos;uploader-file-status&apos;)[0]</span><br><span class="line">					.getElementsByTagName(&apos;span&apos;)[0]</span><br><span class="line">				_tag.innerText = statusMap[status].text</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;,</span><br><span class="line">		// 保护md5计算</span><br><span class="line">		protectComputeMd5(id, status) &#123;</span><br><span class="line">			this.$nextTick(() =&gt; &#123;</span><br><span class="line">				let _tag = this.$refs[&apos;uploader-file-list&apos;].getElementsByClassName(&apos;file_&apos; + id)[0]</span><br><span class="line">				if (status) &#123;</span><br><span class="line">					_tag.setAttribute(&apos;status&apos;, &apos;protect&apos;)</span><br><span class="line">				&#125; else &#123;</span><br><span class="line">					_tag.setAttribute(&apos;status&apos;, &apos;paused&apos;)</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	watch: &#123;&#125;,</span><br><span class="line">	destroyed() &#123;</span><br><span class="line">		this.$off(&apos;openUploader&apos;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">.uploader-list &#123;</span><br><span class="line">	margin-top: 10px;</span><br><span class="line">&#125;</span><br><span class="line">ul li &#123;</span><br><span class="line">	list-style: none;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h5 id="组件使用"><a href="#组件使用" class="headerlink" title="组件使用"></a>组件使用</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-form size=&quot;mini&quot; ref=&quot;form&quot; :model=&quot;form&quot; label-width=&quot;70px&quot; label-position=&quot;right&quot;&gt;</span><br><span class="line">	&lt;el-form-item label=&quot;选择文件&quot; prop=&quot;filename&quot;&gt;</span><br><span class="line">		&lt;el-input placeholder=&quot;请选择文件&quot; v-model=&quot;form.filename&quot; :disabled=&quot;true&quot;&gt;</span><br><span class="line">			&lt;template slot=&quot;append&quot;&gt;</span><br><span class="line">				&lt;upload class=&quot;upload-demo&quot; @fileAdded=&quot;fileAdded&quot; @fileSuccess=&quot;fileSuccess&quot; @fileError=&quot;fileError&quot;&gt;</span><br><span class="line">				&lt;/upload&gt;</span><br><span class="line">			&lt;/template&gt;</span><br><span class="line">		&lt;/el-input&gt;</span><br><span class="line">		&lt;span v-if=&quot;uploadStatus === &apos;UPLOADING&apos;&quot; class=&quot;uploadLoading&quot;&gt;&lt;i class=&quot;iconfont iconLoading&quot;&gt;&lt;/i&gt;上传中&lt;/span&gt;</span><br><span class="line">		&lt;span v-if=&quot;uploadStatus === &apos;FULFILLED&apos;&quot; class=&quot;uploadSuccess&quot;&gt;&lt;i class=&quot;iconfont iconSuccess&quot;&gt;&lt;/i&gt;上传成功&lt;/span&gt;</span><br><span class="line">		&lt;span v-if=&quot;uploadStatus === &apos;REJECTED&apos;&quot; class=&quot;uploadFail&quot;&gt;&lt;i class=&quot;iconfont iconFail&quot;&gt;&lt;/i&gt;&#123;&#123; uoloadErrorMessage &#125;&#125;&lt;/span&gt;</span><br><span class="line">	&lt;/el-form-item&gt;</span><br><span class="line">&lt;/el-form&gt;</span><br><span class="line">&lt;div slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">	&lt;el-button type=&quot;primary&quot; size=&quot;mini&quot; @click=&quot;handleSubmit&quot;&gt;确定&lt;/el-button&gt;</span><br><span class="line">	&lt;el-button type=&quot;primary&quot; size=&quot;mini&quot; @click=&quot;visible = false&quot; plain&gt;取消&lt;/el-button&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">	data()&#123;</span><br><span class="line">		retuen&#123;</span><br><span class="line">			form: &#123;&#125;,</span><br><span class="line">            uploadFile: &#123;&#125;,</span><br><span class="line">			uploadStatus: &apos;PENDING&apos; // PENDING--初始状态，UPLOADING--正在上传，FULFILLED--成功，REJECTED--失败</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">    methods:&#123;</span><br><span class="line">        // 开始添加文件</span><br><span class="line">		fileAdded() &#123;</span><br><span class="line">			this.uploadStatus = &apos;UPLOADING&apos;</span><br><span class="line">            console.log(&apos;开始上传&apos;)</span><br><span class="line">		&#125;,</span><br><span class="line">		// 上传成功</span><br><span class="line">		fileSuccess(file) &#123;</span><br><span class="line">			this.uploadStatus = &apos;FULFILLED&apos;</span><br><span class="line">			let fileName = file.name</span><br><span class="line">			let type = fileName.substr(fileName.lastIndexOf(&apos;.&apos;) + 1)</span><br><span class="line">			let name = fileName.split(`.$&#123;type&#125;`).join(&apos;&apos;)</span><br><span class="line">			this.uploadFile = file</span><br><span class="line">			this.uploadFile._name = name</span><br><span class="line">			this.uploadFile._type = type</span><br><span class="line">			this.form.filename = name</span><br><span class="line">			console.log(&apos;上传成功&apos;)</span><br><span class="line">		&#125;,</span><br><span class="line">		// 上传失败</span><br><span class="line">		fileError(res) &#123;</span><br><span class="line">			this.uoloadErrorMessage = res</span><br><span class="line">			this.uploadStatus = &apos;REJECTED&apos;</span><br><span class="line">            console.log(&apos;上传失败&apos;)</span><br><span class="line">		&#125;,</span><br><span class="line">		// 确认导入资源</span><br><span class="line">		handleSubmit() &#123;</span><br><span class="line">			let params = &#123;</span><br><span class="line">				fileId: this.uploadFile.fid,</span><br><span class="line">                type: this.uploadFile._type</span><br><span class="line">				name: this.uploadFile._name</span><br><span class="line">			&#125;</span><br><span class="line">			this.$store</span><br><span class="line">				.dispatch(&apos;model/addModel&apos;, params)</span><br><span class="line">				.then(res =&gt; &#123; BusinessUtil.CallbackHandler(res) &#125;)</span><br><span class="line">				.then(() =&gt; &#123;</span><br><span class="line">					this.visible = false</span><br><span class="line">					this.form = &#123;</span><br><span class="line">						professional: &apos;&apos;,</span><br><span class="line">						filename: &apos;&apos;</span><br><span class="line">					&#125;</span><br><span class="line">					this.uploadStatus = &apos;PENDING&apos;</span><br><span class="line">					this.uploadFile = &#123;&#125;</span><br><span class="line">				&#125;)</span><br><span class="line">		&#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;  </span><br><span class="line">&lt;style lang=&quot;scss&quot;&gt;</span><br><span class="line">.formDialog &#123;</span><br><span class="line">	.el-input-group__append &#123;</span><br><span class="line">		padding: 0;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	.uploader-btn &#123;</span><br><span class="line">		padding: 0 !important;</span><br><span class="line">		width: 84px;</span><br><span class="line">		height: 26px;</span><br><span class="line">		display: flex !important;</span><br><span class="line">		align-items: center;</span><br><span class="line">		justify-content: center;</span><br><span class="line">		border: none !important;</span><br><span class="line">		font-size: 12px !important;</span><br><span class="line">		color: #0065eb !important;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	.uploader-list &#123;</span><br><span class="line">		display: none !important;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	.iconfont &#123;</span><br><span class="line">		font-size: 12px !important;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	.uploadLoading &#123;</span><br><span class="line">		color: #0065eb;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	.uploadSuccess &#123;</span><br><span class="line">		color: #52c41a;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	.uploadFail &#123;</span><br><span class="line">		color: #ff4d4f;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h5 id="最终效果"><a href="#最终效果" class="headerlink" title="最终效果"></a>最终效果</h5><p><img src="https://www.kffhi.com/public/blog/images/20200919/3.png" alt></p>
<h4 id="文件下载"><a href="#文件下载" class="headerlink" title="文件下载"></a>文件下载</h4><p>下载为后端返回的二进制文件流，主要思路就是使用<code>Blob</code>和<code>FileReader</code>对象，产生的二进制链接使用<code>&lt;a&gt;</code>标签的<code>a.download</code>方法下载，这里需要注意的是这样下载的文件默认是txt文件，需要<strong>手动指定</strong>文件类型</p>
<p><code>Blob</code>构造函数返回一个新创建的 <code>Blob</code> 对象，其内容由参数中给定的数组串联组成，具体展开见<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob" target="_blank" rel="noopener">MDN</a></p>
<p><code>FileReader</code>对象允许Web应用程序异步读取存储在用户计算机上的文件（或原始数据缓冲区）的内容，使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/File" target="_blank" rel="noopener"><code>File</code></a> 或 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob" target="_blank" rel="noopener"><code>Blob</code></a> 对象指定要读取的文件或数据，详见<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader" target="_blank" rel="noopener">MDN</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">handleDown(index, row) &#123;</span><br><span class="line">	<span class="keyword">this</span>.$store</span><br><span class="line">		.dispatch(<span class="string">'model/downloadModel'</span>, row.id)</span><br><span class="line">		.then(<span class="function"><span class="params">res</span> =&gt;</span> BusinessUtil.CallbackHandler(res))</span><br><span class="line">		.then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">			<span class="keyword">const</span> content = res.data</span><br><span class="line">			<span class="keyword">const</span> blob = <span class="keyword">new</span> Blob([content])</span><br><span class="line">			<span class="keyword">let</span> reader = <span class="keyword">new</span> FileReader()</span><br><span class="line">			reader.readAsText(blob, <span class="string">'utf-8'</span>)</span><br><span class="line">			reader.onload = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					<span class="keyword">let</span> error = reader.result</span><br><span class="line">					<span class="keyword">let</span> jsonError = <span class="built_in">JSON</span>.parse(error)</span><br><span class="line">					<span class="keyword">this</span>.$message(&#123;</span><br><span class="line">						message: jsonError.message,</span><br><span class="line">						type: <span class="string">'error'</span></span><br><span class="line">					&#125;)</span><br><span class="line">					<span class="comment">// Message.error(jsonError.message)</span></span><br><span class="line">				&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">					<span class="keyword">let</span> a = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>)</span><br><span class="line">					a.href = URL.createObjectURL(blob)</span><br><span class="line">					<span class="built_in">console</span>.log(a.href)</span><br><span class="line">					a.download = <span class="string">`<span class="subst">$&#123;row.name&#125;</span>.<span class="subst">$&#123;row.type&#125;</span>`</span></span><br><span class="line">					a.target = <span class="string">'_blank'</span></span><br><span class="line">					a.click()</span><br><span class="line">					a.remove()</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/blog/tags/前端/" rel="tag"># 前端</a>
          
            <a href="/blog/tags/JS/" rel="tag"># JS</a>
          
            <a href="/blog/tags/Vue/" rel="tag"># Vue</a>
          
            <a href="/blog/tags/element-ui/" rel="tag"># element ui</a>
          
            <a href="/blog/tags/表单/" rel="tag"># 表单</a>
          
            <a href="/blog/tags/upload/" rel="tag"># upload</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/blog/2020/08/23/基于element-ui实现穿梭树组件/" rel="next" title="基于element-ui实现穿梭树组件">
                <i class="fa fa-chevron-left"></i> 基于element-ui实现穿梭树组件
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/blog/2020/10/02/JavaScript设计模式与开发实践笔记/" rel="prev" title="JavaScript设计模式与开发实践笔记">
                JavaScript设计模式与开发实践笔记 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Kffhi</p>
              <p class="site-description motion-element" itemprop="description">Kffhi的博客</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/blog/archives/">
              
                  <span class="site-state-item-count">42</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/blog/categories/index.html">
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/blog/tags/index.html">
                  <span class="site-state-item-count">55</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#普通上传"><span class="nav-number">1.</span> <span class="nav-text">普通上传</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#在from中使用"><span class="nav-number">1.1.</span> <span class="nav-text">在from中使用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#自定义的上传"><span class="nav-number">1.2.</span> <span class="nav-text">自定义的上传</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#默认上传"><span class="nav-number">1.3.</span> <span class="nav-text">默认上传</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#分片上传"><span class="nav-number">2.</span> <span class="nav-text">分片上传</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#上传组件的实现"><span class="nav-number">2.1.</span> <span class="nav-text">上传组件的实现</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#组件使用"><span class="nav-number">2.2.</span> <span class="nav-text">组件使用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#最终效果"><span class="nav-number">2.3.</span> <span class="nav-text">最终效果</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#文件下载"><span class="nav-number">3.</span> <span class="nav-text">文件下载</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Kffhi</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/blog/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/blog/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/blog/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/blog/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/blog/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/blog/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
